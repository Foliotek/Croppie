!function(e,t){"function"==typeof define&&define.amd?define(["exports","b"],t):"object"==typeof exports&&"string"!=typeof exports.nodeName?t(exports,require("b")):t(e.commonJsStrict={},e.b)}(this,function(e){function t(e){if(e in B)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=M.length;n--;)if(e=M[n]+t,e in B)return e}function n(e,t){for(var n in t)t[n]&&t[n].constructor&&t[n].constructor===Object?(e[n]=e[n]||{},arguments.callee(e[n],t[n])):e[n]=t[n];return e}function o(e,t,n){var o;return function(){var r=this,i=arguments,s=function(){o=null,n||e.apply(r,i)},a=n&&!o;clearTimeout(o),o=setTimeout(s,t),a&&e.apply(r,i)}}function r(e){if("createEvent"in document){var t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0),e.dispatchEvent(t)}else e.fireEvent("onchange")}function i(e,t,n){if("string"==typeof t){var o=t;t={},t[o]=n}for(var r in t)e.style[r]=t[r]}function s(e){var t=e.points,n=document.createElement("div"),o=document.createElement("img"),r=t[2]-t[0],s=t[3]-t[1];return n.classList.add("croppie-result"),n.appendChild(o),i(o,{left:-1*t[0]+"px",top:-1*t[1]+"px"}),o.src=e.url,i(n,{width:r+"px",height:s+"px"}),n}function a(e,t){var n=t.points,o=n[0],r=n[1],i=n[2]-n[0],s=n[3]-n[1],a=t.circle,l=document.createElement("canvas"),u=l.getContext("2d"),c=i,m=s;return t.outputWidth&&t.outputHeight&&(c=t.outputWidth,m=t.outputHeight),l.width=c,l.height=m,a&&(u.save(),u.beginPath(),u.arc(c/2,m/2,c/2,0,2*Math.PI,!0),u.closePath(),u.clip()),u.drawImage(e,o,r,i,s,0,0,c,m),l.toDataURL()}function l(e,t){var n,o=t||new Image;return n=new Promise(function(t){"http"===e.substring(0,4).toLowerCase()&&o.setAttribute("crossOrigin","anonymous"),o.onload=function(){setTimeout(function(){t(o)},1)}}),o.src=e,n}function u(){var e,t,n,o,r=this,s=["croppie-container"],a=r.options.viewport.type?"cr-vp-"+r.options.viewport.type:null;r.data={},r.elements={},e=r.elements.boundary=document.createElement("div"),n=r.elements.viewport=document.createElement("div"),t=r.elements.img=document.createElement("img"),o=r.elements.overlay=document.createElement("div"),e.classList.add("cr-boundary"),i(e,{width:r.options.boundary.width+"px",height:r.options.boundary.height+"px"}),n.classList.add("cr-viewport"),a&&n.classList.add(a),i(n,{width:r.options.viewport.width+"px",height:r.options.viewport.height+"px"}),t.classList.add("cr-image"),o.classList.add("cr-overlay"),r.element.appendChild(e),e.appendChild(t),e.appendChild(n),e.appendChild(o),r.element.classList.add(s),r.options.customClass&&r.element.classList.add(r.options.customClass),h.call(this),r.options.zoomer.enableZoom&&m.call(r)}function c(e){this.options.zoomer.enableZoom&&(this.elements.zoomer.value=C(e,4))}function m(){function e(){f.call(s),o=new F(s.elements.img),r=s.elements.viewport.getBoundingClientRect(),i=P.parse(s.elements.img)}function t(){p.call(s,{value:parseFloat(l.value),origin:o||new F(s.elements.img),viewportRect:r||s.elements.viewport.getBoundingClientRect(),transform:i||P.parse(s.elements.img)})}function n(n){var o,r;o=n.wheelDelta?n.wheelDelta/1200:n.deltaY?n.deltaY/1060:n.detail?n.detail/60:0,r=s._currentZoom+o,n.preventDefault(),e(),c.call(s,r),t()}var o,r,i,s=this,a=s.elements.zoomerWrap=document.createElement("div"),l=s.elements.zoomer=document.createElement("input");a.classList.add("cr-slider-wrap"),l.type="range",l.classList.add("cr-slider"),l.step="0.0001",l.value=s.options.zoomer.initialZoom,l.style.display=s.options.zoomer.showZoomer?"":"none",s.element.appendChild(a),a.appendChild(l),s._currentZoom=s.options.zoomer.initialZoom,s.elements.zoomer.addEventListener("mousedown",e),s.elements.zoomer.addEventListener("touchstart",e),s.elements.zoomer.addEventListener("input",t),s.elements.zoomer.addEventListener("change",t),s.options.zoomer.mouseWheelZoom&&(s.elements.boundary.addEventListener("mousewheel",n),s.elements.boundary.addEventListener("DOMMouseScroll",n))}function p(e){var t=this,n=e.transform,o=e.viewportRect,r=e.origin;t._currentZoom=e.value,n.scale=t._currentZoom;var s=d.call(t,o),a=s.translate,l=s.origin;n.x>=a.maxX&&(r.x=l.minX,n.x=a.maxX),n.x<=a.minX&&(r.x=l.maxX,n.x=a.minX),n.y>=a.maxY&&(r.y=l.minY,n.y=a.maxY),n.y<=a.minY&&(r.y=l.maxY,n.y=a.minY);var u={};u[Y]=n.toString(),u[A]=r.toString(),i(t.elements.img,u),I.call(t),v.call(t)}function d(e){var t=this,n=t._currentZoom,o=e.width,r=e.height,i=t.options.boundary.width/2,s=t.options.boundary.height/2,a=t._originalImageWidth,l=t._originalImageHeight,u=a*n,c=l*n,m=o/2,p=r/2,d=-1*(m/n-i),f=d-(u*(1/n)-o*(1/n)),h=-1*(p/n-s),g=h-(c*(1/n)-r*(1/n)),v=1/n*m,y=u*(1/n)-v,w=1/n*p,_=c*(1/n)-w;return{translate:{maxX:d,minX:f,maxY:h,minY:g},origin:{maxX:y,minX:v,maxY:_,minY:w}}}function f(){var e=this,t=e._currentZoom,n=e.elements.img.getBoundingClientRect(),o=e.elements.viewport.getBoundingClientRect(),r=P.parse(e.elements.img.style[Y]),s=new F(e.elements.img),a=o.top-n.top+o.height/2,l=o.left-n.left+o.width/2,u={},c={};u.y=a/t,u.x=l/t,c.y=(u.y-s.y)*(1-t),c.x=(u.x-s.x)*(1-t),r.x-=c.x,r.y-=c.y;var m={};m[A]=u.x+"px "+u.y+"px",m[Y]=r.toString(),i(e.elements.img,m)}function h(){function e(e){if(e.preventDefault(),!m){if(m=!0,o=e.pageX,s=e.pageY,e.touches){var r=e.touches[0];o=r.pageX,s=r.pageY}transform=P.parse(u.elements.img),window.addEventListener("mousemove",t),window.addEventListener("touchmove",t),window.addEventListener("mouseup",n),window.addEventListener("touchend",n),document.body.style[R]="none",l=u.elements.viewport.getBoundingClientRect()}}function t(e){e.preventDefault();var t=e.pageX,n=e.pageY;if(e.touches){var m=e.touches[0];t=m.pageX,n=m.pageY}var p=t-o,d=n-s,f=u.elements.img.getBoundingClientRect(),h=transform.y+d,v=transform.x+p,y={};if("touchmove"==e.type&&e.touches.length>1){var w=e.touches[0],_=e.touches[1],b=Math.sqrt((w.pageX-_.pageX)*(w.pageX-_.pageX)+(w.pageY-_.pageY)*(w.pageY-_.pageY));a||(a=b/u._currentZoom);var x=b/a;return c.call(u,x),void r(u.elements.zoomer)}l.top>f.top+d&&l.bottom<f.bottom+d&&(transform.y=h),l.left>f.left+p&&l.right<f.right+p&&(transform.x=v),y[Y]=transform.toString(),i(u.elements.img,y),g.call(u),s=n,o=t}function n(){m=!1,window.removeEventListener("mousemove",t),window.removeEventListener("touchmove",t),window.removeEventListener("mouseup",n),window.removeEventListener("touchend",n),document.body.style[R]="",f.call(u),v.call(u),a=0}var o,s,a,l,u=this,m=!1;u.elements.overlay.addEventListener("mousedown",e),u.elements.overlay.addEventListener("touchstart",e)}function g(){var e=this,t=e.elements.boundary.getBoundingClientRect(),n=e.elements.img.getBoundingClientRect();i(e.elements.overlay,{width:n.width+"px",height:n.height+"px",top:n.top-t.top+"px",left:n.left-t.left+"px"})}function v(){var e=this;y.call(e)&&e.options.update.call(e,e.get())}function y(){return this.elements.img.offsetHeight>0&&this.elements.img.offsetWidth>0}function w(){var e=this;e._isZoomAuthorized===!1&&(e.options.zoomer.enableZoom=!0,e._isZoomAuthorized=null,e.elements.zoomer.style.display=e.options.zoomer.showZoomer?"":"none");var t,n,o,s,a,l=e.options.zoomer.minZoom,u=e.options.zoomer.maxZoom,m=e.options.zoomer.initialZoom,p={},d=e.elements.img,f=e.elements.zoomer,h=new P(0,0,1),v=new F,w=y.call(e);if(w&&!e.data.bound){if(e.data.bound=!0,p[Y]=h.toString(),p[A]=v.toString(),i(d,p),t=d.getBoundingClientRect(),n=e.elements.viewport.getBoundingClientRect(),o=e.elements.boundary.getBoundingClientRect(),e._originalImageWidth=t.width,e._originalImageHeight=t.height,e.options.zoomer.enableZoom){s=n.width/t.width,a=n.height/t.height;var x=Math.max(s,a);(null===l||x>l)&&(l=x),null===m&&(m=Math.max(o.width/t.width,o.height/t.height)),l>=u&&(u=m=l,e.options.zoomer.enableZoom&&(e.options.zoomer.enableZoom=e._isZoomAuthorized=!1,e.elements.zoomer.style.display="none")),f.min=C(l,4),f.max=C(u,4),c.call(e,m),r(f)}e._currentZoom=h.scale=m,p[Y]=h.toString(),i(d,p),e.data.points.length?_.call(e,e.data.points):b.call(e),g.call(e)}}function _(e){if(4!=e.length)throw"Croppie - Invalid number of points supplied: "+e;var t=this,n=e[2]-e[0],o=t.elements.viewport.getBoundingClientRect(),r=t.elements.boundary.getBoundingClientRect(),s={left:o.left-r.left,top:o.top-r.top},a=o.width/n,l=e[1],u=e[0],m=-1*e[1]+s.top,p=-1*e[0]+s.left,d={};d[A]=u+"px "+l+"px",d[Y]=new P(p,m,a).toString(),i(t.elements.img,d),c.call(t,a),t._currentZoom=a}function b(){var e=this,t=e.elements.img.getBoundingClientRect(),n=e.elements.viewport.getBoundingClientRect(),o=e.elements.boundary.getBoundingClientRect(),r=n.left-o.left,s=n.top-o.top,a=r-(t.width-n.width)/2,l=s-(t.height-n.height)/2,u=new P(a,l,e._currentZoom);i(e.elements.img,Y,u.toString())}function x(e,t){var n,o=this,r=[];if("string"==typeof e)n=e;else if(Array.isArray(e))r=e.slice();else{if("undefined"==typeof e&&o.data.url)return w.call(o),v.call(o),null;n=e.url,r=e.points||[]}o.data.bound=!1,o.data.url=n||o.data.url,o.data.points=(r||o.data.points).map(function(e){return parseFloat(e)});var i=l(n,o.elements.img);return i.then(function(){w.call(o),v.call(o),t&&t()}),i}function C(e,t){return parseFloat(e).toFixed(t||0)}function E(){var e=this,t=e.elements.img.getBoundingClientRect(),n=e.elements.viewport.getBoundingClientRect(),o=n.left-t.left,r=n.top-t.top,i=o+n.width,s=r+n.height,a=e._currentZoom;return(a===1/0||isNaN(a))&&(a=1),o=Math.max(0,o/a),r=Math.max(0,r/a),i=Math.max(0,i/a),s=Math.max(0,s/a),{points:[C(o),C(r),C(i),C(s)],zoom:a}}function z(e){var t,n,o=this,r=E.call(o),i=e||{type:"canvas",size:"viewport"},u="string"==typeof i?i:i.type,c=i.size||"viewport";return"viewport"===c&&(t=o.elements.viewport.getBoundingClientRect(),r.outputWidth=t.width,r.outputHeight=t.height),r.circle="circle"===o.options.viewport.type,r.url=o.data.url,n=new Promise(function(e){"canvas"===u?l(r.url).then(function(t){e(a(t,r))}):e(s(r))})}function Z(){console.warn("Croppie.refresh() is deprecated.  Please use Croppie.bind() without any arguments instead.  refresh() will be removed in a later release."),w.call(this)}function L(){var e=this;e.element.removeChild(e.elements.boundary),e.options.zoomer.enableZoom&&e.element.removeChild(e.elements.zoomerWrap),delete e.elements}function S(e,t){this.element=e,this.options=n(n({},S.defaults),t),u.call(this)}"function"!=typeof Promise&&function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function t(e){return"function"==typeof e}function n(e){return"object"==typeof e&&null!==e}function o(e){W=e}function r(e){k=e}function i(){return function(){process.nextTick(c)}}function s(){return function(){T(c)}}function a(){var e=0,t=new Q(c),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function l(){var e=new MessageChannel;return e.port1.onmessage=c,function(){e.port2.postMessage(0)}}function u(){return function(){setTimeout(c,1)}}function c(){for(var e=0;q>e;e+=2){var t=G[e],n=G[e+1];t(n),G[e]=void 0,G[e+1]=void 0}q=0}function m(){try{var e=require,t=e("vertx");return T=t.runOnLoop||t.runOnContext,s()}catch(n){return u()}}function p(){}function d(){return new TypeError("You cannot resolve a promise with itself")}function f(){return new TypeError("A promises callback cannot return that same promise.")}function h(e){try{return e.then}catch(t){return te.error=t,te}}function g(e,t,n,o){try{e.call(t,n,o)}catch(r){return r}}function v(e,t,n){k(function(e){var o=!1,r=g(n,t,function(n){o||(o=!0,t!==n?_(e,n):x(e,n))},function(t){o||(o=!0,C(e,t))},"Settle: "+(e._label||" unknown promise"));!o&&r&&(o=!0,C(e,r))},e)}function y(e,t){t._state===$?x(e,t._result):t._state===ee?C(e,t._result):E(t,void 0,function(t){_(e,t)},function(t){C(e,t)})}function w(e,n){if(n.constructor===e.constructor)y(e,n);else{var o=h(n);o===te?C(e,te.error):void 0===o?x(e,n):t(o)?v(e,n,o):x(e,n)}}function _(t,n){t===n?C(t,d()):e(n)?w(t,n):x(t,n)}function b(e){e._onerror&&e._onerror(e._result),z(e)}function x(e,t){e._state===V&&(e._result=t,e._state=$,0!==e._subscribers.length&&k(z,e))}function C(e,t){e._state===V&&(e._state=ee,e._result=t,k(b,e))}function E(e,t,n,o){var r=e._subscribers,i=r.length;e._onerror=null,r[i]=t,r[i+$]=n,r[i+ee]=o,0===i&&e._state&&k(z,e)}function z(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var o,r,i=e._result,s=0;s<t.length;s+=3)o=t[s],r=t[s+n],o?S(n,o,r,i):r(i);e._subscribers.length=0}}function Z(){this.error=null}function L(e,t){try{return e(t)}catch(n){return ne.error=n,ne}}function S(e,n,o,r){var i,s,a,l,u=t(o);if(u){if(i=L(o,r),i===ne?(l=!0,s=i.error,i=null):a=!0,n===i)return void C(n,f())}else i=r,a=!0;n._state!==V||(u&&a?_(n,i):l?C(n,s):e===$?x(n,i):e===ee&&C(n,i))}function A(e,t){try{t(function(t){_(e,t)},function(t){C(e,t)})}catch(n){C(e,n)}}function Y(e,t){var n=this;n._instanceConstructor=e,n.promise=new e(p),n._validateInput(t)?(n._input=t,n.length=t.length,n._remaining=t.length,n._init(),0===n.length?x(n.promise,n._result):(n.length=n.length||0,n._enumerate(),0===n._remaining&&x(n.promise,n._result))):C(n.promise,n._validationError())}function R(e){return new oe(this,e).promise}function M(e){function t(e){_(r,e)}function n(e){C(r,e)}var o=this,r=new o(p);if(!H(e))return C(r,new TypeError("You must pass an array to race.")),r;for(var i=e.length,s=0;r._state===V&&i>s;s++)E(o.resolve(e[s]),void 0,t,n);return r}function B(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(p);return _(n,e),n}function X(e){var t=this,n=new t(p);return C(n,e),n}function j(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function P(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function F(e){this._id=le++,this._state=void 0,this._result=void 0,this._subscribers=[],p!==e&&(t(e)||j(),this instanceof F||P(),A(this,e))}function I(){var e;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;(!n||"[object Promise]"!==Object.prototype.toString.call(n.resolve())||n.cast)&&(e.Promise=ue)}var O;O=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var T,W,D,H=O,q=0,k=({}.toString,function(e,t){G[q]=e,G[q+1]=t,q+=2,2===q&&(W?W(c):D())}),N="undefined"!=typeof window?window:void 0,U=N||{},Q=U.MutationObserver||U.WebKitMutationObserver,J="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),K="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,G=new Array(1e3);D=J?i():Q?a():K?l():void 0===N&&"function"==typeof require?m():u();var V=void 0,$=1,ee=2,te=new Z,ne=new Z;Y.prototype._validateInput=function(e){return H(e)},Y.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},Y.prototype._init=function(){this._result=new Array(this.length)};var oe=Y;Y.prototype._enumerate=function(){for(var e=this,t=e.length,n=e.promise,o=e._input,r=0;n._state===V&&t>r;r++)e._eachEntry(o[r],r)},Y.prototype._eachEntry=function(e,t){var o=this,r=o._instanceConstructor;n(e)?e.constructor===r&&e._state!==V?(e._onerror=null,o._settledAt(e._state,t,e._result)):o._willSettleAt(r.resolve(e),t):(o._remaining--,o._result[t]=e)},Y.prototype._settledAt=function(e,t,n){var o=this,r=o.promise;r._state===V&&(o._remaining--,e===ee?C(r,n):o._result[t]=n),0===o._remaining&&x(r,o._result)},Y.prototype._willSettleAt=function(e,t){var n=this;E(e,void 0,function(e){n._settledAt($,t,e)},function(e){n._settledAt(ee,t,e)})};var re=R,ie=M,se=B,ae=X,le=0,ue=F;F.all=re,F.race=ie,F.resolve=se,F.reject=ae,F._setScheduler=o,F._setAsap=r,F._asap=k,F.prototype={constructor:F,then:function(e,t){var n=this,o=n._state;if(o===$&&!e||o===ee&&!t)return this;var r=new this.constructor(p),i=n._result;if(o){var s=arguments[o-1];k(function(){S(o,r,s,i)})}else E(n,r,e,t);return r},"catch":function(e){return this.then(null,e)}};var ce=I,me={Promise:ue,polyfill:ce};"function"==typeof define&&define.amd?define(function(){return me}):"undefined"!=typeof module&&module.exports?module.exports=me:"undefined"!=typeof this&&(this.ES6Promise=me),ce()}.call(this);var A,Y,R,M=["Webkit","Moz","ms"],B=document.createElement("div").style;Y=t("transform"),A=t("transformOrigin"),R=t("userSelect");var X="translate3d",j=", 0px",P=function(e,t,n){this.x=parseFloat(e),this.y=parseFloat(t),this.scale=parseFloat(n)};P.parse=function(e){return e.style?P.parse(e.style[Y]):e.indexOf("matrix")>-1||e.indexOf("none")>-1?P.fromMatrix(e):P.fromString(e)},P.fromMatrix=function(e){var t=e.substring(7).split(",");return t.length&&"none"!==e||(t=[1,0,0,1,0,0]),new P(parseInt(t[4],10),parseInt(t[5],10),parseFloat(t[0]))},P.fromString=function(e){var t=e.split(") "),n=t[0].substring(X.length+1).split(","),o=t.length>1?t[1].substring(6):1,r=n.length>1?n[0]:0,i=n.length>1?n[1]:0;return new P(r,i,o)},P.prototype.toString=function(){return X+"("+this.x+"px, "+this.y+"px"+j+") scale("+this.scale+")"};var F=function(e){if(!e||!e.style[A])return this.x=0,void(this.y=0);var t=e.style[A].split(" ");this.x=parseFloat(t[0]),this.y=parseFloat(t[1])};F.prototype.toString=function(){return this.x+"px "+this.y+"px"};var I=o(g,500);if(this.jQuery){var O=this.jQuery;O.fn.croppie=function(e){var t=typeof e;if("string"===t){var n=Array.prototype.slice.call(arguments,1),o=O(this).data("croppie");return"get"===e?o.get():"result"===e?o.result.apply(o,n):this.each(function(){var t=O(this).data("croppie");if(t){var o=t[e];if(!O.isFunction(o))throw"Croppie "+e+" method not found";o.apply(t,n),"destroy"===e&&O(this).removeData("croppie")}})}return this.each(function(){var t=new S(this,e);O(this).data("croppie",t)})}}S.defaults={viewport:{width:100,height:100,type:"square"},boundary:{width:300,height:300},zoomer:{enableZoom:!0,showZoomer:!0,mouseWheelZoom:!0,initialZoom:null,maxZoom:1.5,minZoom:null},customClass:"",update:function(){}},n(S.prototype,{bind:function(e,t){return x.call(this,e,t)},get:function(){return E.call(this)},result:function(e){return z.call(this,e)},refresh:function(){return Z.call(this)},setZoom:function(e){c.call(this,e),r(this.elements.zoomer)},destroy:function(){return L.call(this)}}),e.Croppie=window.Croppie=S});